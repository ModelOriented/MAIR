{
  "abstractText": "Machine Learning (ML) is proving extremely beneficial in many healthcare applications. In pediatric oncology, retrospective studies that investigate the relationship between treatment and late adverse effects still rely on simple heuristics. To assess the effects of radiation therapy, treatment plans are typically simulated on phantoms, i.e., virtual surrogates of patient anatomy. Currently, phantoms are built according to reasonable, yet simple, humandesigned criteria. This often results in a lack of individualization. We present a novel approach that combines imaging and ML to build individualized phantoms automatically. Given the features of a patient treated historically (only 2D radiographs available), and a database of 3D Computed Tomography (CT) imaging with organ segmentations and relative patient features, our approach uses ML to predict how to assemble a patient-specific phantom automatically. Experiments on 60 abdominal CTs of pediatric patients show that our approach constructs significantly more representative phantoms than using current phantom building criteria, in terms of location and shape of the abdomen and of two considered organs, the liver and the spleen. Among several ML algorithms considered, the Gene-pool Optimal Mixing Evolutionary Algorithm for Genetic Programming (GP-GOMEA) is found to deliver the best performing models, which are, moreover, transparent and interpretable mathematical expressions.",
  "authors": [
    {
      "affiliations": [],
      "name": "Marco Virgolina"
    },
    {
      "affiliations": [],
      "name": "Ziyuan Wangb"
    },
    {
      "affiliations": [],
      "name": "Tanja Alderliestenb"
    },
    {
      "affiliations": [],
      "name": "Peter A. N. Bosmana"
    }
  ],
  "id": "SP:1f00f26913666ce765e76e0adfb059a0e017b5a5",
  "references": [
    {
      "authors": [
        "C. Lee",
        "J.W. Jung",
        "C. Pelletier"
      ],
      "title": "Reconstruction of organ dose for external radiotherapy patients in retrospective epidemiologic studies,",
      "venue": "Physics in Medicine & Biology",
      "year": 2015
    },
    {
      "authors": [
        "X.G. Xu"
      ],
      "title": "An exponential growth of computational phantom research in radiation protection, imaging, and radiotherapy: a review of the fifty-year history,",
      "venue": "Physics in Medicine & Biology 59(18),",
      "year": 2014
    },
    {
      "authors": [
        "J.V. Bezin",
        "R.S. Allodji",
        "J.-P. M\u00e8ge"
      ],
      "title": "A review of uncertainties in radiotherapy dose reconstruction and their impacts on dose\u2013response relationships,",
      "venue": "Journal of Radiological Protection 37(1),",
      "year": 2017
    },
    {
      "authors": [
        "M. Stovall",
        "S.S. Donaldson",
        "R.E. Weathers"
      ],
      "title": "Genetic effects of radiotherapy for childhood cancer: Gonadal dose reconstruction,",
      "venue": "International Journal of Radiation Oncology \u00b7 Biology \u00b7 Physics 60(2),",
      "year": 2004
    },
    {
      "authors": [
        "R.M. Howell",
        "S.A. Smith",
        "R.E. Weathers"
      ],
      "title": "Adaptations to a generalized radiation dose reconstruction methodology for use in epidemiologic studies: An update from the md anderson late effect group,",
      "venue": "Radiation research",
      "year": 2019
    },
    {
      "authors": [
        "A.M. Geyer",
        "S. O\u2019Reilly",
        "C. Lee"
      ],
      "title": "The UF/NCI family of hybrid computational phantoms representing the current US population of male and female children, adolescents, and adults-application to CT dosimetry,",
      "venue": "Physics in Medicine & Biology",
      "year": 2014
    },
    {
      "authors": [
        "I. Alziar",
        "G. Bonniaud",
        "D. Couanet"
      ],
      "title": "Individual radiation therapy patient wholebody phantoms for peripheral dose evaluations: method and specific software,",
      "venue": "Physics in Medicine & Biology 54(17),",
      "year": 2009
    },
    {
      "authors": [
        "T. Xie",
        "N. Kuster",
        "H. Zaidi"
      ],
      "title": "Computational hybrid anthropometric paediatric phantom library for internal radiation dosimetry,",
      "venue": "Physics in Medicine & Biology 62(8),",
      "year": 2017
    },
    {
      "authors": [
        "J. Valentin"
      ],
      "title": "Basic anatomical and physiological data for use in radiological protection: reference values: Icrp publication 89,",
      "venue": "Annals of the ICRP 32(3-4),",
      "year": 2002
    },
    {
      "authors": [
        "R.J. Kuczmarski",
        "K.M. Flegal",
        "S.M. Campbell"
      ],
      "title": "Increasing prevalence of overweight among us adults: the national health and nutrition examination",
      "venue": "JAMA 272(3),",
      "year": 1960
    },
    {
      "authors": [
        "M. Virgolin",
        "I.W.E.M. van Dijk",
        "J. Wiersma"
      ],
      "title": "On the feasibility of automatically selecting similar patients in highly individualized radiotherapy dose reconstruction for historic data of pediatric cancer survivors,",
      "venue": "Medical Physics 45(4),",
      "year": 2018
    },
    {
      "authors": [
        "Z. Wang",
        "I.W.E.M. van Dijk",
        "J. Wiersma"
      ],
      "title": "Are age and gender suitable matching criteria in organ dose reconstruction using surrogate childhood cancer patients\u2019 CT scans?,",
      "venue": "Medical Physics 45(6),",
      "year": 2018
    },
    {
      "authors": [
        "Z. Obermeyer",
        "E.J. Emanuel"
      ],
      "title": "Predicting the future\u2013big data, machine learning, and clinical medicine,",
      "venue": "The New England Journal of Medicine 375(13),",
      "year": 2016
    },
    {
      "authors": [
        "N. Breslow",
        "A. Olshan",
        "J.B. Beckwith"
      ],
      "title": "Epidemiology of Wilms tumor,",
      "venue": "Medical and Pediatric Oncology 21(3),",
      "year": 1993
    },
    {
      "authors": [
        "I.W.E.M. van Dijk",
        "F. Oldenburger",
        "M.C. Cardous-Ubbink"
      ],
      "title": "Evaluation of late adverse events in long-term Wilms\u2019 tumor survivors,",
      "venue": "International Journal of Radiation Oncology \u00b7 Biology \u00b7 Physics 78(2),",
      "year": 2010
    },
    {
      "authors": [
        "A. Fedorov",
        "R. Beichel",
        "J. Kalpathy-Cramer"
      ],
      "title": "3D Slicer as an image computing platform for the quantitative imaging network,",
      "venue": "Magnetic Resonance Imaging 30(9),",
      "year": 2012
    },
    {
      "authors": [
        "S.C. Huijskens",
        "I.W.E.M. van Dijk",
        "J. Visser"
      ],
      "title": "Magnitude and variability of respiratory-induced diaphragm motion in children during image-guided radiotherapy,",
      "venue": "Radiotherapy and Oncology",
      "year": 2017
    },
    {
      "authors": [
        "M. Xi",
        "M.Z. Liu",
        "Q.Q. Li"
      ],
      "title": "Analysis of abdominal organ motion using fourdimensional CT,",
      "venue": "Chinese Journal of Cancer 28(9),",
      "year": 2009
    },
    {
      "authors": [
        "A. Jain",
        "K. Nandakumar",
        "A. Ross"
      ],
      "title": "Score normalization in multimodal biometric systems,",
      "venue": "Pattern Recognition",
      "year": 2005
    },
    {
      "authors": [
        "L.R. Dice"
      ],
      "title": "Measures of the amount of ecologic association between species,",
      "venue": "Ecology 26(3),",
      "year": 1945
    },
    {
      "authors": [
        "K.H. Zou",
        "S.K. Warfield",
        "A. Bharatha"
      ],
      "title": "Statistical validation of image segmentation quality based on a spatial overlap index: scientific reports,",
      "venue": "Academic Radiology 11(2),",
      "year": 2004
    },
    {
      "authors": [
        "S. Nikolov",
        "S. Blackwell",
        "R. Mendes"
      ],
      "title": "Deep learning to achieve clinically applicable segmentation of head and neck anatomy for radiotherapy,",
      "year": 2018
    },
    {
      "authors": [
        "B. Efron",
        "T. Hastie",
        "I. Johnstone"
      ],
      "title": "Least angle regression,",
      "venue": "Annals of Statistics 32(2),",
      "year": 2004
    },
    {
      "authors": [
        "R. Tibshirani"
      ],
      "title": "Regression shrinkage and selection via the lasso,",
      "venue": "Journal of the Royal Statistical Society. Series B (Methodological) ,",
      "year": 1996
    },
    {
      "authors": [
        "J.R. Koza"
      ],
      "title": "Genetic programming as a means for programming computers by natural selection,",
      "venue": "Statistics and Computing",
      "year": 1994
    },
    {
      "authors": [
        "R. Poli",
        "W.B. Langdon",
        "N.F. McPhee"
      ],
      "title": "A Field Guide to Genetic Programming, Lulu Enterprises",
      "venue": "UK Ltd",
      "year": 2008
    },
    {
      "authors": [
        "M. Virgolin",
        "T. Alderliesten",
        "C. Witteveen"
      ],
      "title": "Scalable genetic programming by genepool optimal mixing and input-space entropy-based building-block learning,",
      "venue": "Proceedings of the Genetic and Evolutionary Computation Conference,",
      "year": 2017
    },
    {
      "authors": [
        "M. Virgolin",
        "T. Alderliesten",
        "C. Witteveen"
      ],
      "title": "Improving model-based genetic programming for symbolic regression of small expressions,",
      "year": 1904
    },
    {
      "authors": [
        "R. Guidotti",
        "A. Monreale",
        "S. Ruggieri"
      ],
      "title": "A survey of methods for explaining black box models,",
      "venue": "ACM computing surveys (CSUR) 51(5),",
      "year": 2018
    },
    {
      "authors": [
        "J. Friedman",
        "T. Hastie",
        "R. Tibshirani"
      ],
      "title": "GLMNET: Lasso and elastic-net regularized generalized linear models,\u201d R package version",
      "year": 2009
    },
    {
      "authors": [
        "M.N. Wright",
        "A. Ziegler"
      ],
      "title": "Ranger: a fast implementation of random forests for high dimensional data in C++ and R,",
      "year": 2015
    },
    {
      "authors": [
        "P. Probst",
        "A.-L"
      ],
      "title": "Boulesteix, \u201cTo tune or not to tune the number of trees in random forest.,",
      "venue": "Journal of Machine Learning Research",
      "year": 2017
    },
    {
      "authors": [
        "J. Ni",
        "R.H. Drieberg",
        "P.I. Rockett"
      ],
      "title": "The use of an analytic quotient operator in genetic programming,",
      "venue": "IEEE Transactions on Evolutionary Computation",
      "year": 2013
    },
    {
      "authors": [
        "M. Kuhn"
      ],
      "title": "The caret package,",
      "venue": "Journal of Statistical Software 28(5),",
      "year": 2008
    },
    {
      "authors": [
        "P.A.N. Bosman",
        "J. Grahl",
        "D. Thierens"
      ],
      "title": "Enhancing the performance of maximum\u2013 likelihood Gaussian EDAs using anticipated mean shift,",
      "venue": "in International Conference on Parallel Problem Solving from Nature,",
      "year": 2008
    },
    {
      "authors": [
        "P.A.N. Bosman",
        "J. Grahl",
        "D. Thierens"
      ],
      "title": "Benchmarking parameter-free AMALGAM on functions with and without noise,",
      "venue": "Evolutionary Computation",
      "year": 2013
    },
    {
      "authors": [
        "A.N.I. Badouna",
        "C. Veres",
        "N. Haddy"
      ],
      "title": "Total heart volume as a function of clinical and anthropometric parameters in a population of external beam radiation therapy patients,",
      "venue": "Physics in Medicine & Biology 57(2),",
      "year": 2012
    },
    {
      "authors": [
        "E.J. Stepusin",
        "D.J. Long",
        "E.L. Marshall"
      ],
      "title": "Assessment of different patient-to-phantom matching criteria applied in Monte Carlo\u2013based computed tomography dosimetry,",
      "venue": "Medical Physics 44(10),",
      "year": 2017
    },
    {
      "authors": [
        "Z. Wang",
        "B.V. Balgobind",
        "M. Virgolin"
      ],
      "title": "How do patient characteristics and anatomical features correlate to accuracy of organ dose reconstruction for Wilms\u2019 tumor radiation treatment plans when using a surrogate patient\u2019s CT scan?,",
      "venue": "Journal of Radiological Protection 39(2),",
      "year": 2019
    },
    {
      "authors": [
        "J. Dem\u0161ar"
      ],
      "title": "Statistical comparisons of classifiers over multiple data sets,",
      "venue": "Journal of Machine Learning Research 7,",
      "year": 2006
    },
    {
      "authors": [
        "J.M. Bland",
        "D.G. Altman"
      ],
      "title": "Multiple significance tests: the Bonferroni method,",
      "venue": "BMJ 310(6973),",
      "year": 1995
    },
    {
      "authors": [
        "J.H. Friedman"
      ],
      "title": "Greedy function approximation: a gradient boosting machine,",
      "venue": "Annals of Statistics ,",
      "year": 2001
    },
    {
      "authors": [
        "C. Pinter",
        "A. Lasso",
        "A. Wang"
      ],
      "title": "SlicerRT: radiation therapy research toolkit for 3D Slicer,",
      "venue": "Medical Physics 39(10),",
      "year": 2012
    },
    {
      "authors": [
        "A. Ng",
        "T. Nguyen",
        "J.L. Moseley"
      ],
      "title": "Reconstruction of 3D lung models from 2D planning data sets for Hodgkin\u2019s lymphoma patients using combined deformable image registration and navigator channels,",
      "venue": "Medical Physics 37(3),",
      "year": 2010
    }
  ],
  "sections": [
    {
      "text": "Keywords: machine learning, pediatric cancer, radiation treatment, dose reconstruction, phantom.\n*Marco Virgolin, marco.virgolin@cwi.nl"
    },
    {
      "heading": "1 Introduction",
      "text": "Virtual anthropomorphic phantoms are 3D representations of the human body that are used as surrogates for the anatomy of humans, to estimate the quantity and geometric distribution of radiation dose when having been exposed to radiation, e.g., in radiation treatment for cancer patients.1, 2 Because anatomy resemblance is one of the key sources of uncertainty in dose estimation,3 the phantom needs to represent the anatomy of the patient for whom estimates are needed with high precision.\nCurrent methods for phantom building have two major limitations. Firstly, traditionally, building phantoms is a manual and time-consuming task. Approximations of human anatomies are produced using simple geometrical shapes,4, 5 or by considering actual organ segmentations from Computed Tomography (CT) scans.6\u20138 These anatomies are shaped and/or adapted according to population-based statistics and/or reasonable human-designed criteria.4, 6, 7, 9, 10 Because the procedure is laborious, a limited number of phantoms is made, each meant to represent a category of patients. The second and perhaps more fundamental limitation is that it is unknown how to best define categorization criteria that best capture resemblance in individual patient anatomy. So far, only simple criteria such as partitioning by combinations of age, gender, percentiles height and weight, have been explored.4, 6\u20138 Nevertheless, several studies have indicated that such simple criteria are incapable of capturing the high variance in human internal anatomy,2, 6, 11, 12 and this can ultimately lead to coarse dose estimations.13\nar X\niv :1\n90 9.\n03 72\n3v 1\n[ cs\n.L G\n] 9\nS ep\n2 01\n9\nMachine Learning (ML) is becoming more and more a reliable approach to tackle hard and heterogeneous problems in healthcare.14 This is because ML can infer patterns from data that are hard to spot, and to model for humans. In the context of phantom construction, the use of ML could improve upon the rough categorization methods that are currently being employed. In this article, we present a new take on phantom construction that shows that it is possible to use ML to obtain better phantoms. In particular, we propose an automatic phantom-construction pipeline that can be used to generate pseudo-realistic phantoms that are patient-specific. To overcome the need for laborious manual intervention, we propose to re-use 3D patient imaging (CT scans and organ segmentations) collected in a database, to assemble new anatomy combinations. To estimate how to best perform this assembling, i.e., to move beyond the use of too simplistic criteria, we rely on ML. Specifically, we train ML models to learn relationships between patient features and 3D metrics based on their internal anatomy.\nWe consider a relatively hard scenario where phantoms are needed and patient features are limited: dose reconstruction for historical patients, i.e., patients treated in the pre-3D planning era, when radiation treatment plans were designed using 2D radiographs. As no 3D imaging is available for historical patients to simulate the treatment and estimate the radiation dose distribution, phantoms are necessary to act as surrogate anatomies in order to reconstruct 3D dose distributions.12, 13 We focus on children between 2 to 6 years, and on dose reconstruction for abdominal radiation treatment, for the following reasons. Firstly, children are typically under-represented in existing phantom libraries, i.e., phantoms are available for few categories.4, 6 Secondly, the inclusion of radiation treatment has led to high survival rates for several types of pediatric abdominal cancer (e.g., Wilms\u2019 tumor, the most common type of kidney cancer), but it is known to cause late adverse effects.15, 16 Thirdly, it has recently been shown that when CT scans are selected based on age and gender to serve as a surrogate for pediatric abdominal patients, there is a high risk of obtaining inaccurate dose reconstructions.13 The ultimate goal is to realize sufficiently accurate dose reconstruction by use of more representative phantoms, which can then be used to better understand how radiation dose contributes to the onset of late adverse effects. Providing this information can support radiation oncologists in the design of better treatment plans with smaller chances of adverse effects for today\u2019s abdominal radiation treatment."
    },
    {
      "heading": "2 Materials and Methods",
      "text": ""
    },
    {
      "heading": "2.1 Data",
      "text": "We built a database using data of 60 pediatric cancer patients, in the age range of 2 to 6 years. The patients were treated after 2002 at the radiation oncology department of the Amsterdam UMC, location AMC, in Amsterdam, or at the University Medical Center Utrecht/Princess Ma\u0300xima Center for Pediatric Oncology in Utrecht. For each patient, a CT is available that fully includes the lower part of the thorax to the lower part of the abdomen, specifically from the top of the Thoracic 10th vertebra (T10) to the bottom of the Sacral 1st vertebra (S1). The median axial thickness of the CT scan is 2.5mm, and the median in-plane resolution is 1.0mm\u00d7 1.0mm.\nTo simulate the scenario of dose reconstruction for patients treated in the pre-3D planning era, we only consider patient features that were typically recorded at the time. We base our choices on the availability of features for the Emma Children\u2019s Hospital/Academic Medical Center (EKZ/AMC) childhood cancer survivor cohort, treated between 1966 and 1996.16 One important source of information for the EKZ/AMC cohort is 2D coronal radiographs, which were acquired\nto plan radiation treatment. The coronal radiographs enable us to perform measurements, along Left-Right (LR) and Inferior-Superior (IS) directions, based on visible anatomical landmarks, i.e., the bony anatomy (see Fig. 1). For our cohort of recently treated patients, we simulate historical radiographs using Digitally Reconstructed Radiographs (DRRs), derived from the CTs using inhouse developed software. Figure 1 (left, middle) shows an example of a historical radiograph and of a DRR.\nTable 1 lists the features considered in this work. Features involving measurements from DRRs were collected after manual placement of landmarks (using 3D Slicer software17), exemplified in Fig. 1 (right). The only source of information on the Anterior-Posterior (AP) direction is the abdominal diameter, that was historically measured using rulers and calipers, at the center of the radiation treatment field (which corresponded with the isocenter for the EKZ/AMC cohort). For our cohort, we measured the abdominal diameter along AP from the CTs, using a typical isocenter position for abdominal flank irradiation, as described in our previous work.12 Figure 2 shows the Pearson correlation coefficients between the considered features. Most features are moderately correlated, and few are strongly correlated, e.g., height with age and weight. The distance along IS between the top of the right diaphragm and T12 (RDIS) stands out as it is associated with the lowest correlations with any other feature. We measured this feature in an attempt to capture information on the breathing state of the patient, which is known to be correlated with organ position.18, 19 The low correlation is likely because the particular breathing state of the patient can be reasonably expected to be not correlated with the other features we considered.\nWe consider two Organs At Risk (OARs), i.e., organs for which exposure to radiation is known to lead to adverse effects: the liver and the spleen. These OARs are particularly interesting because their shape and position is known to vary substantially per individual, and are very hard to predict.12 In general, the liver and spleen are not (clearly) visible in historical radiographs (see Fig. 1). For each patient in the cohort, 3D segmentations of the OARs and of the external body (delimited along IS between T10 and S1) were firstly automatically generated (with ADMIRE research software, 2.3.0, Elekta AB, Stockholm, Sweden), then manually checked and corrected by experienced radiation treatment technologists (with Velocity software, version 3.2.0, Varian Medical Systems, Inc.\nPalo Alto, CA, US), and finally approved by a pediatric radiation oncologist."
    },
    {
      "heading": "2.2 Pipeline for automatic phantom construction",
      "text": "The outcome of our pipeline is a CT-based phantom, built using recent patient imaging data. The goal is to resemble the anatomy of the historical patient as closely as possible.\nThe pipeline is summarized in Fig. 3. Given the patient features as input, first an ML model MBodyS is used to predict which CT is most resembling in terms of overall body shape (for the abdominal region). We call this CT the \u201creceiver\u201d. Then, the OARs of the receiver are \u201cresected\u201d. Resection of an OAR is performed by setting the voxels of the receiver that belong to the OAR to Hounsfield Unit (HU) values that represent generic soft abdominal tissues (this is a parameter, we used 78, as done in the phantoms of the University of Florida/National Cancer Institute6). Subsequently, for each OAR, its center of mass position is predicted using dedicated models, i.e.,\none for the LR (MOARLR ), one for the AP (MOARAP ), and one for the IS position (MOARIS ). A fifth model (MOARS ) is used to predict which OAR segmentation to retrieve among the ones available based on a shape-focused metric (described in Sec. 2.3.1). We choose to adopt separate models because the features related to one metric may be independent from the ones related to another metric, e.g., we expect features related to the LR direction to be important for the LR coordinate of the center of mass of an OAR, but not (or substantially less) for its AP or IS coordinates and for determining what segmentation has the most promising shape.\nWe refer to the CT that is chosen by MOARS to provide the OAR segmentation as a \u201cdonor\u201d. Next, the segmentation is \u201ctransplanted\u201d into the receiver, using the predicted position. Transplantation is achieved similarly to resection: we add the OAR segmentation to the set of segmentations of the receiver, placed in the predicted position, and we set the HU values of the voxels in the receiver that belong to the OAR segmentation to the respective HU values from the donor scan.\nA final step consists of correcting the phantom for possible anatomical inconsistencies with an Anatomical Inconsistencies Correction (AIC) procedure. This is because the ML models can in principle predict to place segmentations in positions that result in non-realistic anatomy (e.g, OARs overlapping with each other). An optimizer is therefore used to subsequently resize and re-position the OARs to correct for anatomical inconsistencies, with minimal corrections so as to compromise the quality of the ML model predictions as little as possible (more details are given later, in Sec. 2.4).\nTo store CTs and segmentations sets, we relied on the Digital Imaging and Communications in Medicine standard (DICOM). Segmentation sets were stored in DICOM RT-Structure sets. To handle this data format, we used the pydicom package for Python (https://pydicom.github.io/). We do not provide full details on the implementation here (e.g., which fields of the DICOM files are changed and how), but our source code is available at: http://github.com/marcovirgolin/APhA."
    },
    {
      "heading": "2.3 Machine Learning",
      "text": "This section describes how the ML models in the pipeline are trained. Firstly, we present how datasets for supervised learning are built. Secondly, we present the ML algorithms that we selected, and their hyper-parameters. Finally, we describe the learning strategy, i.e., how we train, tune, and validate the models."
    },
    {
      "heading": "2.3.1 Datasets for training",
      "text": "To train the ML models we prepare separate datasets to learn each ML model independently. As aforementioned, we learn separate models under the assumption that 3D metrics are (largely) independent from each other. Hence, 1 + 4 \u00d7 #OARs datasets are needed: one to learn how to pick the receiver CT, three for each OAR to predict the OAR position, and one more for each OAR to predict which segmentation to retrieve.\nWe perform numerical feature normalization by z-scoring,20 i.e., each feature is normalized by subtraction of the mean and division by the standard deviation. Since patient gender is categorical, we set it to a binary value: 0 for females and 1 for males. As no correlation coefficient above 0.9 was found between the features (Fig. 2), we do not exclude any feature. Z-scoring is also applied to the target variable Y.\nWe construct two types of datasets. One type is used for OAR position modeling along three orthogonal directions (i.e., LR, AP, IS). The other type is for donor and receiver retrieval. The\npreparation of the datasets for OAR position modeling is straightforward. We define the OAR position relative to a common landmark: the center of the L2 vertebra. In other words, the OAR position in LR, AP, or IS direction is a signed, one-dimensional distance from the center of the L2 vertebra to the center of mass of the OAR\u2019s segmentation, measured in mm.\nFor the datasets concerning the retrieval of a representative OAR segmentation, a measure of segmentation similarity needs to be defined as target variable. Because a measure of similarity is defined between pairs of segmentations, each example needs to be defined over a pair of patients, leading to a total of #patients(#patients\u2212 1)/2 training examples. For the features, we use a pairwise version of the features defined as the absolute difference of the features of patients p and q: xp,q = |xp \u2212 xq|, with xp being the feature x of patient p. For the target variable, several possibilities to address segmentation similarity have been proposed in literature. For example, a possibility is to consider similarity in OAR weight.8 We do not rely on OAR weight nor volume because they do not account for similarity of shape. Another commonly adopted option to assess OAR similarity is the use of the volumetric Dice-S\u00f8rensen Coefficient (DSC).12, 21, 22 However, the DSC still has limitations, because it is segmentation-volume dependent. We therefore rely on the recently introduced surface Dice-S\u00f8rensen Coefficient (sDSC),23 which considers only significant millimetric deviations between the surfaces of the segmentations to evaluate similarity. In particular, the sDSC uses a threshold parameter \u03c4 that expresses what deviations are acceptable (e.g., as part of inter-observer variability). To choose \u03c4 , we consider that the median CT slice thickness in our database is 2.5mm. Since we deal with inter-patient OAR segmentations, we doubled this value, and adopted \u03c4 = 5.0mm. Because we predict OAR positions separately for each OAR, the sDSC is computed after aligning the segmentations on their center of mass, i.e., to maximally\nfocus on the shape. Furthermore, we consider sDSC values as percentages (0 to 100)."
    },
    {
      "heading": "2.3.2 Loss function for learning",
      "text": "As loss function to train and validate the ML algorithms we consider the Mean Absolute Error (MAE), i.e.,\nMAE(y, y\u0302) = n\u2211\ni=1\n|yi \u2212 y\u0302i|,\nwhere y and y\u0302 are n-dimensional vectors of ground-truth values and ML predictions respectively. Clearly, the MAE needs to be minimized. We choose to use the MAE because it is relatively simple to interpret, as it preserves the unit of measurement of the metric at hand (mm for OAR positions, % for sDSC between OAR segmentations), and weighs all errors equally.\nFor OAR positions, computing the MAE is straightforward both at training and at test time. Given n cases, it suffices to measure the absolute difference between each ground-truth position and its prediction, and take the average upon all examples.\nThe sDSC is defined between pairs of patient OAR segmentations. Here, ML algorithms predictions correspond to estimations of sDSC between OAR segmentation pairs, and MAE minimization means to correctly predict the sDSC. At training time, the MAE between predictions and ground-truth sDSC is measured. The measurement of validation MAE is more involved. In particular, when validation is needed for a patient who was not included in the training data, i.e., to obtain a segmentation for a test patient, we firstly create pairwise features (Table 1) between that patient and each other patient in the database (as absolute feature differences as described in 2.3.1). Subsequently, the model uses the pairwise features as input, and produces predictions of sDSC between the OAR segmentation of the test patient and the one of each other patient (see the input of MOARS andM Body S in Fig. 3). Now, we do not compute the MAE between these predictions and the ground-truth sDSCs as test error, because the predictions do not correspond to any particular segmentation in the database. Rather, they give an indication of how the OAR segmentation of each patient will fare against the OAR segmentation of the test patient in terms of sDSC. Therefore, we proceed by retrieving the segmentation from the database that has the largest predicted sDSC with the test patient. Finally, we evaluate the actual sDSC between these two segmentations, and report that.\nNote that the maximum score of OAR shape similarity achievable is not necessarily 100%, rather, it is the maximum sDSC that can be obtained with the OAR segmentations available in the database. To frame the future comparisons that involve different metrics, i.e., OAR positions and OAR shape, we define \u03b5sDSC = 100 \u2212 sDSC, which is minimal (0%) when the sDSC is maximal (100%), and is maximal (100%) when the sDSC is minimal (0%). This way, both errors in OAR positioning and in OAR shape retrieval can be considered as a metric to be minimized."
    },
    {
      "heading": "2.3.3 Algorithms",
      "text": "We compare a total of five regression ML algorithms: Least-Angle RegreSsion (LARS),24 LARS using the Least Absolute Shrinkage and Selection Operator (LASSO),25 Random Forest (RF),26 traditional Genetic Programming (GP-Trad),27, 28 and the Genetic Programming instance of the\nGene-pool Optimal Mixing Evolutionary Algorithm (GP-GOMEA).29, 30 These algorithms are interesting because they include hyper-parameters that can be used to prevent overfitting, which is a likely scenario when the data is limited as in many medical applications, including ours.\nLARS and LASSO are widely used approaches that work based on the assumption that the features can be combined linearly, and include penalization metrics to avoid overfitting. LASSO also performs feature selection. Both algorithms build models that can be read as mathematical expressions consisting of a linear combination of the features, and are therefore considered interpretable.31 We optimize the hyper-parameter \u03bb, i.e., the penalization factor, as described in Sec. 2.3.5. We use the implementation of the package glmnet, in R.32, 33\nRF is also widely used, but it is different from the previous two as it allows non-linear modeling. RF builds a model as an ensemble of decision trees to reduce variance in estimation and thus overfitting. Because the model is an ensemble, it is considered not interpretable.31 We optimize how many features are randomly chosen when building the nodes that compose each decision tree (mtry), and the minimum number of data samples a node should represent (min. node size), the same way we optimize \u03bb for LARS and LASSO (see Sec. 2.3.5). We use the R implementation known as ranger.34\nThe Genetic Programming algorithms are interesting because, like LARS and LASSO, they deliver models in the form of mathematical expressions, but they can include non-linear feature combinations. These algorithms work by loosely mimicking the concept of Darwinian evolution, i.e., by iterative recombination of candidate mathematical expressions made of atomic functions, and selection of the fittest. Recombination in GP-Trad is highly stochastic, whereas the one of GP-GOMEA includes information theory-based mechanisms to estimate what patterns of atomic functions should be preserved during recombination attempts. GP-GOMEA was recently found to work particularly well when small, yet accurate expressions are needed.30 To reduce the number of hyper-parameters, we use these algorithms within a scheme of interleaved runs of increasing capacity (described in sec 2.3.4). We use the C++ implementation of GP-Trad and GP-GOMEA (https://github.com/marcovirgolin/GP-GOMEA)."
    },
    {
      "heading": "2.3.4 Hyper-parameter settings",
      "text": "Table 2 shows the hyper-parameters used by the ML algorithms. LARS and LASSO use \u03bb to penalize complex models. For RF, we use the default relatively large number of trees (given the datasets at hand) of 500.35\nFor GP-Trad and GP-GOMEA, the function set F defines which functions to use as model components (tree nodes). The division operator\u00f7A is the analytic quotient,36 which not only guarantees that the divider can never be null, but also ensures smoothness (in contrast with the protected division operator,28 which can harm generalization36). The logarithm operator is protected to avoid infeasible computations.27 The Ephemeral Random Constants (ERC) are constants for which the value is set by uniform sampling from a defined interval.28 Mathematical expressions are encoded as parse trees in GP-Trad and GP-GOMEA. We set a small tree height to keep the resulting mathematical expressions short and readable (we found that larger three heights can result in hard to read expressions), and to prevent overfitting.\nThe number of candidate expressions to evolve, i.e., the population size, is a sensitive parameter for GP algorithms. We run GP-Trad and GP-GOMEA using the Interleaved Multistart Scheme (IMS), a method that interleaves multiple runs with increasing population size. We set the number\nof sub-iterations between runs, gIMS, to 4 as has been reported to work well on benchmark problems.29, 30 Since the IMS can in principle run forever, we set a time limit of 60 seconds. We found this limit to be reasonable because the datasets are small and evaluations are fast, and because the other ML algorithms take only a few seconds to execute. We also preliminarily observed that increasing the time limit (e.g., to 5 or 10 minutes) does not alter the results in a significant way. For further details on GP-Trad, GP-GOMEA, the IMS, and other hyper-parameters, the reader is referred to the seminal paper on GP-GOMEA for regression.30"
    },
    {
      "heading": "2.3.5 Learning strategy",
      "text": "With a limited number of 60 patients available, we perform leave-one-out cross-validation to compute the overall test performance. The leave-one-out cross-validation is performed \u201cpatient-wise\u201d, i.e., all the examples relative to a particular patient p are removed from the training set, and solely used for testing. This is obvious for the datasets on OAR position, as each row corresponds to exactly one patient. For the datasets on OAR segmentation retrieval, however, each row represents a pair of patients (see Sec. 2.3.1). Therefore, all #patients\u2212 1 (59) rows where p is considered are removed from the training set and put in the test set. This is necessary to avoid a positive bias in the test results.\nWithin each iteration of leave-one-out cross-validation, for LARS, LASSO, and RF, we perform grid-search hyper-parameter tuning with 5-fold cross-validation upon the training data, to determine the best hyper-parameter values. We use the R package caret for this purpose.37 Once the best hyper-parameter settings are found, we train the ML algorithm on the training set using those settings, and test it on the test set. For GP-Trad and GP-GOMEA, we take the best expression found by the interleaved runs started by the IMS.\nSince RF, GP-Trad, and GP-GOMEA are stochastic algorithms, we repeat their execution 10 times, and report the mean result."
    },
    {
      "heading": "2.4 Anatomical inconsistency correction",
      "text": "The last step of our pipeline repairs possible anatomical inconsistencies present in the assembled phantoms. We automatically compute possible overlaps between the transplanted OARs (liver and spleen), and between the OARs and the spinal cord segmentation of the receiver, which is available for these patients. To have an additional margin, we enlarge the spinal cord segmentation by 10%\nuniformly in all dimensions. Furthermore, we assess if the transplanted OARs stick out of the segmentation of the body of the receiver. If a larger segmentation of the body exists than the common region of interest between T10 and S1 (used to assess body shape similarity to train ML models), that segmentation is used here. Again, for robustness, the body segmentation is shrunk uniformly in all dimensions, by 2.5%. The values chosen for spinal cord segmentation expansion (10%) and body segmentation shrinking (2.5%) were found to deliver pleasing results by visual inspection.\nWe use a general purpose, derivative-free real-valued optimization algorithm to modify the transplanted OAR segmentations to eliminate the anatomical inconsistencies, with default parameter settings.38, 39 The algorithm is configured to act on both liver and spleen at the same time, with modifications (i.e., optimization variables) that can expand or shrink the segmentations (up to 1.25 and 0.25 of the original volume respectively), as well as reposition their center of mass along LR, AP, IS (up to 10mm for each direction). We set anatomical inconsistencies as hard constraints to satisfy. Modifying the OARs to satisfy the constraints deviates from the predictions of the ML models, and can therefore result in less accurate phantoms. Therefore, we use an objective that conflicts with the constraints, in that it attempts to minimize the effect of OAR modifications: for each OAR being corrected, we use the same objective of the ML algorithms to capture the shape of OARs, i.e., the sDSC (again with threshold of 5mm), this time compared to its originally-predicted shape and position. The final objective is given by summing the sDSC of both liver and spleen, to be maximized."
    },
    {
      "heading": "2.5 Comparing to phantom selection approaches",
      "text": "As we mentioned in the introduction, it is common practice in phantom-based dose reconstruction to select a phantom from a library according to some criteria. As CTs of actual patients can act as phantoms, we consider several approaches to compare with our pipeline: two methods that simulate state of the art human-designed criteria used to build and select from phantom libraries, random selection, and one method to select a single CT from our database based on ML predictions."
    },
    {
      "heading": "2.5.1 Human-designed criteria for phantom selection",
      "text": "The first methods we consider are the criterion used by the University of Texas MD Anderson Cancer Center,4, 5 which we refer to as Human Criterion 1 (HC1), and the criterion used by the University of Florida/National Cancer Institute,6 which we refer to as Human Criterion 2 (HC2). We further consider random selection, to see if the other methods are better than random.\nThe phantoms on which HC1 has previously been used are virtual cuboid shapes with OARs represented as point clouds.4, 5 Only the age of the patient is considered as a feature to manipulate the phantom\u2019s representativeness by scaling the cuboids according to guidelines on population data. Furthermore, gender is used to exclude/include gender-specific OARs. To simulate HC1, i.e., age binning, we cluster our database into age bins, by rounding the age to years. This results in 5 bins, with the following distribution: 10 patients of age 2, 18 of age 3, 11 of age 4, 15 of age 5, and 6 of age 6.\nFor a test patient p, we consider the other patients from the database that share the same age bin with p. Then, for each metric of interest, we report the average error given by comparing the metric value for p with the one for each other patient that has the same age as p. For example, for the assessment of liver segmentation similarity of a patient p that is 3 years old, we compute the\nsDSC between p and each other patient that is 3 years old, and return the mean. By doing this, we simulate the fact that an average anatomy has been built using the anatomical information of all patients (different from p) that have the same age. We do this because phantoms are built to represent average anatomies.\nThe phantom library where HC2 is adopted comprises phantoms made by scaling segmentations acquired from actual patient CT scans, thus they are quite realistic.6 For these phantoms, the features considered to build the library were gender, height, and weight (age was not used). HC2 uses these features to select a representative phantom. We simulate HC2 by clustering our database by gender, and by height and weight, using 5 bins for each of the latter two. We use the bin method of the R package binr (http://jabiru.github.io/binr/) for this purpose, with default settings, which results in 5 bins of 12 patients each. Like for HC1, the error for a metric is given by comparing the metric value for the test patient p with the metric values of each patient that shares the same bin of p, and taking the average.\nTo assess whether there is any merit in using the human-design criteria, we also consider a control method where the OAR positions and segmentations are retrieved uniformly at random from the set of patients, excluding the test patient p. Because of the stochastic nature of this approach, each iteration is repeated 10 times, and mean results are computed. In the following, we refer to this method as RAND.\nAs we propose a pipeline to build a phantom, it is interesting to assess how it fares against a simpler approach, e.g., to use ML predictions to select a single, overall most representative CT scan. This approach can be related to literature, where new ways to identify which phantom to pick are studied.12, 40, 41\nWhile our phantom construction pipeline can predict the different 3D metrics independently (position for each direction, sDSC for each OAR), for a single CT approach, an overall score needs to be defined that expresses how representative a CT scan is. The design of such a score is not trivial.12 For example, a choice needs to be made on whether 5mm along the LR direction is more important or less important than an sDSC loss of 5%. For the sake of simplicity, we propose a score measure that considers only OAR positions, with equal importance. We choose to focus on OAR position because we recently found it to be the metric that is most correlated with dose accuracy for pediatric abdominal radiation treatment.42 In detail, we take as best CT the one that is closest to the predictions of the ML models in terms of squared position differences, i.e.,\nBest CT = argminCT \u2211 O\u2208OARs \u2211 D\u2208 {LR,AP,IS} ( DOML \u2212DOCT )2 , (1)\nwhere DOML and DOCT are respectively the ML-predicted position and the actually available position in the CT, of the OAR O, along direction D. We denote this approach with sCT.\nNote that sCT is essentially a hybrid between a human-designed criterion, represented by Eq. 1, and the use of ML, of which the predictions are used in the equation. Lastly, since we found GPGOMEA to be the overall best performing ML algorithm (shown later in Sec. 3.1), we used the models found by GP-GOMEA to provide the predictions for sCT."
    },
    {
      "heading": "2.6 Experimental setup",
      "text": "We divide experiments into two parts. In the first part, we compare the predictions of the ML algorithms, in terms of MAE. In the second part, we compare the prediction of the overall best\nperforming ML algorithm with the phantom selection approaches, in a similar way. In this second comparison, we include the effect of anatomical inconsistency correction, to assess how much it compromises the accuracy of the predictions of the ML models.\nWe run the ML algorithms on a machine with two Intel R\u00a9 Xeon R\u00a9 CPU E5-2699 v4 @ 2.20GHz. We assess statistical significance of the results with the Wilcoxon signed-rank test, paired by traintest split (i.e., held-out patient),43 and using the Bonferroni correction method to prevent type I errors.44 In particular, since we perform pairwise tests between the algorithms for each metric, we assess whether the test p-value is below a confidence level of 0.05, further reduced by a Bonferroni correction coefficient, to contrast false positive outcomes due to chance."
    },
    {
      "heading": "3 Results",
      "text": ""
    },
    {
      "heading": "3.1 Comparison of the machine learning algorithms",
      "text": "The mean (and standard deviation) training and test MAE obtained by the leave-one-out crossvalidation of the ML algorithms are reported in Table 3. If multiple results are not found to be statistically significantly worse than the best result, they are considered to be equally good. Note that for consistent use of the MAE, to be minimized, the task of segmentation retrieval uses \u03b5sDSC.\nIn terms of training performance, GP-GOMEA is overall the best algorithm, as it is not significantly worse than any other for 6 metrics, i.e., OAR position for all directions. RF follows with 3 top performances, in particular for the segmentation retrieval task (S) of all OARs, where it achieves markedly lower errors than all other algorithms. LASSO performs worst, with at least one algorithm significantly outperforming it in each metric.\nRegarding the test performance on the patient excluded by the leave-one-out cross-validation, similar to the observed training performance, GP-GOMEA obtains the most significantly best results. GP-GOMEA also generalizes well on predicting which segmentation to select for the liver, but it is inferior to RF when it comes to selecting the segmentations for the body and the spleen. Indeed, for those two segmentations, RF performs better than any other ML algorithm, although the errors at test time are much larger than the ones found at training time. Note that this mismatch between training and test performance can be explained by possible overfitting, as well as by the fact that, at test time, error propagation can happen, since the model prediction is used to retrieve a\ncandidate segmentation from the ones available in the database (this holds for all ML algorithms, see Sec. 2.3.2). GP-Trad scores an extra point compared to RF in terms of number of metrics where it is not outperformed significantly. LARS and LASSO generalize quite well at test time, as they are not inferior to the other ML algorithms on (the same) 3 metrics."
    },
    {
      "heading": "3.2 Machine learning vs. phantom selection approaches",
      "text": "Table 4 shows results comparing the ML algorithm found to perform overall best, GP-GOMEA, to the use of phantom selection approaches. The use of anatomical inconsistency correction upon GP-GOMEA\u2019s predictions is also included now (named GP-GAIC), because we want the pipeline to construct pseudo-realistic phantoms. We remark that since the use of automatic inconsistency correction does not introduce corrections to the body segmentation, there is no difference between GP-GOMEA and GP-GAIC in terms of error for body segmentation retrieval.\nOut of the nine metrics, the correction-less predictions obtained with GP-GOMEA are generally best, with the only exceptions being the IS position and segmentation retrieval for the spleen (by relatively small errors on average). The use of anatomical inconsistency correction upon GPGOMEA\u2019s predictions, GP-GAIC, can change shape and position of the OARs in both considerable (e.g., liver AP and liver S) and minor (e.g., liver LR, spleen IS) magnitude. Figure 4 shows box plots of the corrections on all phantoms. For our database, the anatomical inconsistency correction was triggered for 31/60 phantoms. The liver is subject to more corrections than the spleen: it is typically shrunk more than the spleen, and its position in AP is subject to large variations. This is not surprising, because the liver is a considerably larger organ than the spleen, and it is more likely to violate the anatomical consistency constraints we imposed.\nOverall, correcting for inconsistencies typically comes at the cost of worsening the accuracy of the ML predictions. GP-GAIC has significantly best performance only on 3 metrics (body S, spleen AP, and spleen S). For spleen AP and spleen S, performing inconsistency correction leads to better test results compared to not applying corrections. However, the correction algorithm solely optimizes for resolving the inconsistencies while attempting to retain maximum prediction fidelity. Moreover, because sCT obtains also good results on spleen AP and spleen S, it can be argued that these metrics are not modeled sufficiently well by GP-GOMEA to begin with, and thus are more likely to be improved upon by chance.\nAlthough the use of anatomical inconsistency correction after ML prediction typically leads to larger errors, it remains a valuable approach compared to the other methods. GP-GAIC is overall best when the correction-less GP-GOMEA predictions are excluded from the comparison. The human-designed criteria HC1 and HC2 perform overall worse than GP-GAIC. Despite its simplicity, HC1 performs well for AP and S of the liver. This may be because metrics related to the liver are harder to model by the ML algorithms, and because the use of anatomical inconsistency correction compromises GP-GOMEA\u2019s prediction (particularly notable for liver AP). Despite the fact that HC2 is a somewhat more involved criterion compared to HC1 (HC2 considers gender, height, and weight, while HC1 considers only gender and age), it is never found to be competitive on any metric. This could mean that weight and height are not good features when accounting for similarity of internal anatomy in children. This result is in agreement with previous work42 where lack of correlations between dose reconstruction outcomes were found w.r.t. height and weight.\nImportantly, in some cases, HC1 and HC2 perform particularly bad. HC1 is particularly inaccurate for spleen S compared to the other approaches, and HC2 leads to notably large errors for\nspleen IS. In the latter case, HC2 is not found to be better than RAND. Furthermore, both criteria perform poorly on body S (as well as sCT). Figure 5 shows the reliability function of the considered approaches for body S. This function shows the likelihood of committing errors of a certain magnitude (for segmentation retrieval, in percentage). A curve is better than the others if it is more on the left and if it decreases more rapidly, since this means that the probability of any error magnitude is lower than the ones of the other methods. The figure illustrates that the model learned by GP-GOMEA achieves this behavior. For example, the probability of a GP-GOMEA\u2019s model to predict a body segmentation that has an \u03b5sDSC > 20% (sDSC < 80%) with the actual body of the patient is 60%. For HC2 and sCT, that magnitude of error happens more frequently, i.e., in almost 80% of the cases. HC1 performs worse, since errors above 20% are almost certain. On the other hand, rarely, (probabilities around 5%), HC2 and sCT can retrieve body segmentations that have errors above 80%.\nRegarding sCT, the results indicate that this approach is generally worse than GP-GAIC, but better than the human-designed criteria to predict metrics related to the spleen. sCT performs particularly bad with respect to metrics regarding the liver (note in particular liver LR). This is an interesting result because the CT selected by sCT weighs OAR positions equally for liver and spleen (see Eq. 1). We remark that sCT uses the ML models (found by GP-GOMEA) to predict which single CT scan (and accompanying segmentations) to select by means of a hand-designed metric. Essentially, the results confirm our hypothesis that designing a good score to select one CT is not trivial, and that there is added value in constructing a new anatomy by assembling different components into one."
    },
    {
      "heading": "3.3 Model interpretability",
      "text": "As we mentioned before, the added value of utilizing the linear ML algorithms (LARS and LASSO), and the GP algorithms (GP-Trad and GP-GOMEA) is that their models are mathematical expressions which, if simple enough, can be interpreted. Interpretability can play a crucial role in determining whether ML can be applied in some clinical settings. For RF, the interpretation of the model is essentially impossible, as it returns an ensemble of (500) decision trees. Similarly, this would not be possible with other popular techniques like deep learning,45 and boosting algorithms.46\nWe report all the best-at-test-time models found by GP-GOMEA at http://bit.ly/2Za4ESy. Here, we report two of those models, that are remarkably simple. For the prediction of which\nbody segmentation to retrieve, the model found most frequently in 10 repetitions is (assuming the target variable and the features are normalized):\n0.420\u00d7 (ADAP + ADLR + SCIS) .\nNotably, this model is just a scaled sum of the abdominal diameters (ADAP and ADLR) and of the spinal cord length (SCIS). Essentially, the model uses an equal contribution (features are normalized) of features capturing information of size relative to the three dimensions LR, AP, and IS, to predict which body segmentation to retrieve. This seems a reliable, simple, and reasonable method to select a representative body segmentation.\nA second model we showcase here is the one for the prediction of what spleen segmentation to retrieve:\n2.718AGE \u00d7 0.057\u00d7 SCIS.\nIt is interesting to see that spleen shape is found to be related to age by an exponentiation. This can be considered reasonable for our cohort, because the age of our patients is between 2 to 6 years, where anatomical development is rapid. The length of the spinal cord in IS further weighs the prediction. This feature seems also reasonable to consider, because it captures information relative to the size of the abdomen in IS, and because the spleen is located nearby the spinal cord. Albeit understandable, reasonable, and well-performing, it is arguably unlikely for humans to invent models like these."
    },
    {
      "heading": "4 Examples of automatically constructed phantoms",
      "text": "Following the quantitative results presented in the previous sections, we present some qualitative ones: examples of constructed phantoms. These qualitative results complement the quantitative ones, as the positioning of OARs and their shapes can be visually evaluated in the context of the receiver CT.\nFigure 6 shows 5 phantoms generated with our pipeline, where GP-GOMEA was used to train all models. The images are created by using 3D Slicer17 with module SlicerRT.47 These phantoms have been generated for a test patient that was excluded from the ML training process. The predicted liver and spleen segmentations are highlighted in the receiver CT. Note that the segmentations of the external body and of the spinal cord shown in the figure can extend beyond the commonly available region of interest used for training (from T10 to S1). The receiver CT\u2019s original liver and spleen can also be identified (in part), as their not-overridden voxels are uniformly set to a specific value (78 HUs as done for the phantoms of the University of Florida/National Cancer Institute6) in the resection step. Overlaps of the transplanted OAR can still happen with respect to other organs which are not considered in the training and correction process (e.g., spleen overlapping with the kidneys). Note also the presence of some further remaining limited anatomical inconsistencies, which are not detected by our algorithm (e.g., small overlaps with bony anatomy).\nOur current Python implementation takes about 5 minutes to generate a phantom if no anatomical inconsistencies are found, with resection and transplant taking the most time (we expect that parallelizing voxels\u2019 HU value overwrites will markedly reduce running time). If anatomical inconsistency correction needs to be performed, the whole pipeline can take from a few minutes to a few hours, depending on how complex the correction is for the optimizer, and on the hardware (the\noptimizer is highly parallelizable). As mentioned in Section 3.2, for our database the anatomical inconsistency correction triggered on half the phantoms. However, in our opinion only roughly half of those cases (so 1/4 of the total number of phantoms) had really noticeable anatomical inconsistencies, e.g., large OAR overlaps, or OARs exceeding the body boundaries, that required corrections of large magnitude. In the other cases, inconsistencies were more subtle (e.g., small OAR overlap), and caused corrections of small magnitude.\nFigure 7 shows two examples of anatomical inconsistency correction for cases where inconsistency can be considered large, displaying phantoms pre- and post anatomical inconsistency correction, one to correct the liver, and one to correct the spleen."
    },
    {
      "heading": "5 Discussion",
      "text": "We have presented a new take on phantom construction: a fully-automatic ML-based pipeline that assembles a patient-specific phantom using a database of delineated 3D CT scans, given the features of a patient. We performed experiments upon data of 60 pediatric patients including imaging of the abdomen, and focused on tailoring the position and shape of the liver and the spleen. Our experimental results strongly suggest that our approach leads to much more representative phantoms than using established human-designed criteria, and than using ML to predict a single best CT scan (according to a reasonable notion of overall anatomical similarity). We compared several ML algorithms to provide accurate models for the pipeline, and found GP-GOMEA to deliver overall best performance and models that can also be interpreted, which may be helpful for researchers and clinicians alike to trust their use in a clinical setting.\nOne clear limitation of our work is that we could only employ a small database of 60 patients. It can be reasonably expected that, by increasing the database size, both the errors of the ML models, and the onset of large anatomical inconsistencies, will be reduced. To this end, we are currently working on expanding the number of institutes contributing to the database. Furthermore, we are working on extending the number of OARs to build the phantom (e.g., heart, kidneys) and on extending the region of interest (e.g., abdomen and thorax), for a cohort including older children (2 to 8 years).\nThe automatic anatomical inconsistency correction method may still warrant further improvement. Although we could always resolve the constraint, often without excessively compromising the predictions of the ML models, anatomical inconsistencies can still be present. This is because the constraints are not comprehensive enough. For example, Fig. 8 shows a phantom for which our correction does not violate any of the specified constraints (liver and spleen do not overlap with each other nor with the spinal cord, and the organs do not exceed the body contour) yet the anatomy remains unrealistic because the organs are placed too high with respect to the receiver CT. In fact, this is because it is the prediction of the receiver CT that does not work well for this patient, as it retrieves a body which is quite shorter (14 cm smaller SCIS, sDSC of 60%) compared to the actual body of the patient. Fortunately, this is the only phantom out of 60 where such an evident inconsistency was found and likely the probability of this happening only reduces with a growing database size. Still, we intend to study how to further improve our correction method by attempting to craft more constraints, as well as by including more OARs (e.g., the lungs), which then will need to not overlap with each other.\nWe remark that, in general, phantoms do not need to be anatomically realistic for the purpose of dose reconstruction, especially when doing large dose reconstructions of populations. E.g., as\naforementioned, the University of Texas/MD Anderson Cancer Center uses virtual cuboid phantoms uniformly made of water-equivalent material, where internal organs are represented by point clouds.4, 5 However, realistic surrogate anatomies have arguably a larger chance of being considered familiar and trustworthy by clinicians, whenever e.g., an expert opinion is needed to go beyond simple statistical measurements, and really visualize how the radiation dose distribution may impact healthy tissues.\nAnother limitation of this study is that we used HC1 and HC2 to simulate the process of phantom selection in state of the art phantom libraries on our own database of CT scans and organ segmentations, rather than using phantom libraries. Indeed, the phantoms in those libraries are built to follow statistics relative to large populations. We did investigate the use of the library of the University of Florida/National Cancer Institute, which is of public access, instead of our database, for HC2. We however found that selecting those phantoms leads to no better results than using our database (the body segmentation was not considered because a region of interest between T10 and S1 is not readily available for those phantoms). In particular, it was found to be significantly better for half of the 3D metrics (LR and S for the liver, LR and IS for the spleen), but worse for the other half. We also found the use of the actual library to be always significantly worse than using GP-GOMEA, with exception for LR of the spleen, where it was equivalent. This may be because the statistics on which those phantoms are based, which come from the United States, are not accurately representing the patients of our cohort, who are Dutch.\nIn future work we will consider porting our approach to different types of regions of interest (e.g., head for brain tumors) and cohorts (e.g., older patients). Ultimately, we are interested in generating an entire body anatomy for any patient. We believe our approach is very promising because once appropriate features are defined, no modifications in how to train ML algorithms, nor in how the pipeline works, are needed to obtain new phantoms. Moreover, since the availability of different OAR segmentations is currently limited to what is available in the database, and since\ndelineating new OARs requires specialization, experience, and time, ways to use ML to deform an existing OAR template into a patient-specific segmentation could be worth investigating.48\nFinally, for the aim of obtaining 3D dose distributions to relate to the onset of adverse effects, it will be important to validate our pipeline in terms of dose reconstruction accuracy, i.e., by first crafting a highly individualized phantom, and then simulating the radiation treatment plan using such a phantom. This could be performed similarly to our validation analysis, i.e., with cross-validation on recent patients. Dose metrics should be computed on the actual CT, and then compared with the dose metrics computed on the phantom.12"
    },
    {
      "heading": "6 Conclusion",
      "text": "We have presented a new take on phantom construction that leverages machine learning to assemble existing 3D patient imaging into a new anatomy. Contrary to existing approaches, the pipeline we propose requires no manual intervention except for the initial effort of assembling a database of 3D patient imaging (CTs, segmentations, and patient features), and the measurement of few features of the historical patients on their radiographs. With our approach the problem of finding a globally good metric to represent anatomical categorization, typically faced by phantom libraries, is shifted to train machine learning models for parts of phantoms based on specific 3D metrics. Our experimental results on a database of 60 pediatric cancer patients, focused on liver and spleen, showed that this approach can lead to significantly better anatomical resemblance compared to the use of phantom building criteria that are currently common practice. Positive results were still found after correcting the phantoms for possible anatomical inconsistencies through optimization. Regarding the machine learning algorithm used in the pipeline, we found that GP-GOMEA, a state of the art genetic programming approach, can deliver models that are both accurate and readable. This aspect can be of added value as such models increase the chances of clinicians understanding them better and trusting their use.\nDisclosures\nTanja Alderliesten and Peter A.N. Bosman are involved in projects supported by Elekta (Elekta AB, Stockholm, Sweden). Elekta had no involvement in the study design, data collection, analysis and interpretation, and writing of the article."
    },
    {
      "heading": "Acknowledgments",
      "text": "The authors acknowledge the Kinderen Kankervrij foundation for financial support (project #187), and the Maurits and Anna de Kock foundation for financing a high-performance computing system. We thank dr. Brian V. Balgobind, dr. Irma W.E.M. van Dijk, and dr. Jan Wiersma from the department of radiation oncology of Amsterdam UMC, location AMC, Amsterdam, the Netherlands, and dr. Geert O.R. Janssens and dr. Petra Kroon from the department of radiation oncology of UMC Utrecht Cancer Center, Utrecht, the Netherlands, for providing help in the collection and/or in the assessment of the imaging data used in this work. The authors are grateful to Elekta for providing ADMIRE research software for automatic organ segmentation. We further acknowledge dr. Choonsik Lee from the National Cancer Institute, Division of Cancer Epidemiology & Genetics, Rockville, Maryland, U.S.A., for details on the phantom library of the University of Florida/National Cancer Institute. This article is based upon, and extends (by introducing the anatomical inconsistency correction method and related results), an SPIE proceedings paper of\nwhich an abstract has been recently submitted for consideration to the SPIE conference on Medical Imaging (2020), titled \u201dMachine Learning for Automatic Construction of Pediatric Abdominal Phantoms for Radiation Dose Reconstruction\u201d, authored by the same authors of this article."
    }
  ],
  "title": "Machine learning for automatic construction of pseudo-realistic pediatric abdominal phantoms",
  "year": 2019
}
